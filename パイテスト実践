# Pythoné–¢æ•°ãƒ†ã‚¹ãƒˆã®å®Œå…¨ã‚¬ã‚¤ãƒ‰ï¼špytestå…¥é–€

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ãƒ‘ã‚¿ãƒ¼ãƒ³

### ãƒ‘ã‚¿ãƒ¼ãƒ³1ï¼šåŒä¸€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆã‚·ãƒ³ãƒ—ãƒ«ï¼‰
```
my_project/
â”œâ”€â”€ calculator.py      # é–¢æ•°æœ¬ä½“
â””â”€â”€ test_calculator.py # ãƒ†ã‚¹ãƒˆ
```

### ãƒ‘ã‚¿ãƒ¼ãƒ³2ï¼šåˆ¥ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆå®Ÿè·µçš„ï¼‰
```
my_project/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ calculator.py  # é–¢æ•°æœ¬ä½“
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ test_calculator.py # ãƒ†ã‚¹ãƒˆ
â””â”€â”€ __init__.py
```

### ãƒ‘ã‚¿ãƒ¼ãƒ³3ï¼šãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ§‹é€ ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå‘ã‘ï¼‰
```
my_project/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ calculator.py
â”‚   â””â”€â”€ utils.py
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_calculator.py
â”‚   â””â”€â”€ test_utils.py
â”œâ”€â”€ pytest.ini         # pytestè¨­å®š
â””â”€â”€ requirements.txt   # ä¾å­˜é–¢ä¿‚
```

---

## ğŸš€ ã‚¹ãƒ†ãƒƒãƒ—1ï¼špytestã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# pytestã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install pytest

# ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª
pytest --version
```

---

## ğŸ“ ã‚¹ãƒ†ãƒƒãƒ—2ï¼šåŒä¸€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§å§‹ã‚ã‚‹

### ãƒ•ã‚¡ã‚¤ãƒ«1: `calculator.py` (é–¢æ•°æœ¬ä½“)

```python
# calculator.py
"""è¨ˆç®—æ©Ÿãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«"""


def add(a, b):
    """
    2ã¤ã®æ•°ã‚’è¶³ã™
    
    Args:
        a: æœ€åˆã®æ•°
        b: 2ç•ªç›®ã®æ•°
    
    Returns:
        a + b ã®çµæœ
    """
    # aã¨bã‚’è¶³ã—ã¦è¿”ã™
    return a + b


def subtract(a, b):
    """
    2ã¤ã®æ•°ã‚’å¼•ã
    
    Args:
        a: å¼•ã‹ã‚Œã‚‹æ•°
        b: å¼•ãæ•°
    
    Returns:
        a - b ã®çµæœ
    """
    # aã‹ã‚‰bã‚’å¼•ã„ã¦è¿”ã™
    return a - b


def multiply(a, b):
    """
    2ã¤ã®æ•°ã‚’æ›ã‘ã‚‹
    
    Args:
        a: æœ€åˆã®æ•°
        b: 2ç•ªç›®ã®æ•°
    
    Returns:
        a * b ã®çµæœ
    """
    # aã¨bã‚’æ›ã‘ã¦è¿”ã™
    return a * b


def divide(a, b):
    """
    2ã¤ã®æ•°ã‚’å‰²ã‚‹
    
    Args:
        a: å‰²ã‚‰ã‚Œã‚‹æ•°
        b: å‰²ã‚‹æ•°
    
    Returns:
        a / b ã®çµæœ
    
    Raises:
        ValueError: bãŒ0ã®å ´åˆ
    """
    # bãŒ0ã‹ãƒã‚§ãƒƒã‚¯
    if b == 0:
        # 0ã§å‰²ã‚ã†ã¨ã—ãŸã‚‰ã‚¨ãƒ©ãƒ¼ã‚’ç™ºç”Ÿã•ã›ã‚‹
        raise ValueError("0ã§å‰²ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“")
    
    # aã‚’bã§å‰²ã£ã¦è¿”ã™
    return a / b


def is_even(n):
    """
    å¶æ•°ã‹ã©ã†ã‹åˆ¤å®š
    
    Args:
        n: åˆ¤å®šã™ã‚‹æ•´æ•°
    
    Returns:
        å¶æ•°ãªã‚‰Trueã€å¥‡æ•°ãªã‚‰False
    """
    # nã‚’2ã§å‰²ã£ãŸä½™ã‚ŠãŒ0ãªã‚‰å¶æ•°
    return n % 2 == 0
```

---

### ãƒ•ã‚¡ã‚¤ãƒ«2: `test_calculator.py` (ãƒ†ã‚¹ãƒˆ)

```python
# test_calculator.py
"""calculatorãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒ†ã‚¹ãƒˆ"""

# pytest ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼‰
import pytest

# ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®é–¢æ•°ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
from calculator import add, subtract, multiply, divide, is_even


# ========================================
# addã®ãƒ†ã‚¹ãƒˆ
# ========================================

def test_add_positive_numbers():
    """æ­£ã®æ•°åŒå£«ã®è¶³ã—ç®—ã‚’ãƒ†ã‚¹ãƒˆ"""
    # é–¢æ•°ã‚’å®Ÿè¡Œ
    result = add(3, 5)
    # æœŸå¾…å€¤ã¨æ¯”è¼ƒï¼ˆassertã§æ¤œè¨¼ï¼‰
    assert result == 8  # 3 + 5 = 8 ã®ã¯ãš


def test_add_negative_numbers():
    """è² ã®æ•°ã‚’å«ã‚€è¶³ã—ç®—ã‚’ãƒ†ã‚¹ãƒˆ"""
    # -2 + 5 = 3 ã®ã¯ãš
    assert add(-2, 5) == 3
    
    # -3 + -7 = -10 ã®ã¯ãš
    assert add(-3, -7) == -10


def test_add_zero():
    """0ã‚’å«ã‚€è¶³ã—ç®—ã‚’ãƒ†ã‚¹ãƒˆ"""
    # 0 + 5 = 5 ã®ã¯ãš
    assert add(0, 5) == 5
    
    # 10 + 0 = 10 ã®ã¯ãš
    assert add(10, 0) == 10


# ========================================
# subtractã®ãƒ†ã‚¹ãƒˆ
# ========================================

def test_subtract_positive_numbers():
    """æ­£ã®æ•°åŒå£«ã®å¼•ãç®—ã‚’ãƒ†ã‚¹ãƒˆ"""
    # 10 - 3 = 7 ã®ã¯ãš
    assert subtract(10, 3) == 7


def test_subtract_negative_result():
    """çµæœãŒè² ã«ãªã‚‹å¼•ãç®—ã‚’ãƒ†ã‚¹ãƒˆ"""
    # 5 - 10 = -5 ã®ã¯ãš
    assert subtract(5, 10) == -5


# ========================================
# multiplyã®ãƒ†ã‚¹ãƒˆ
# ========================================

def test_multiply_positive_numbers():
    """æ­£ã®æ•°åŒå£«ã®æ›ã‘ç®—ã‚’ãƒ†ã‚¹ãƒˆ"""
    # 4 * 5 = 20 ã®ã¯ãš
    assert multiply(4, 5) == 20


def test_multiply_by_zero():
    """0ã‚’æ›ã‘ã‚‹ãƒ†ã‚¹ãƒˆ"""
    # ä½•ã«0ã‚’æ›ã‘ã¦ã‚‚0
    assert multiply(100, 0) == 0
    assert multiply(0, 50) == 0


def test_multiply_negative_numbers():
    """è² ã®æ•°ã‚’å«ã‚€æ›ã‘ç®—ã‚’ãƒ†ã‚¹ãƒˆ"""
    # -3 * 4 = -12 ã®ã¯ãš
    assert multiply(-3, 4) == -12
    
    # -2 * -5 = 10 ã®ã¯ãšï¼ˆè² Ã—è² =æ­£ï¼‰
    assert multiply(-2, -5) == 10


# ========================================
# divideã®ãƒ†ã‚¹ãƒˆ
# ========================================

def test_divide_positive_numbers():
    """æ­£ã®æ•°åŒå£«ã®å‰²ã‚Šç®—ã‚’ãƒ†ã‚¹ãƒˆ"""
    # 10 / 2 = 5.0 ã®ã¯ãš
    assert divide(10, 2) == 5.0


def test_divide_with_remainder():
    """å‰²ã‚Šåˆ‡ã‚Œãªã„å‰²ã‚Šç®—ã‚’ãƒ†ã‚¹ãƒˆ"""
    # 7 / 2 = 3.5 ã®ã¯ãš
    result = divide(7, 2)
    # æµ®å‹•å°æ•°ç‚¹ãªã®ã§è¿‘ä¼¼æ¯”è¼ƒ
    assert result == 3.5


def test_divide_by_zero():
    """0ã§å‰²ã‚‹å ´åˆã®ã‚¨ãƒ©ãƒ¼ã‚’ãƒ†ã‚¹ãƒˆ"""
    # withæ–‡ï¼šä¾‹å¤–ãŒç™ºç”Ÿã™ã‚‹ã“ã¨ã‚’æœŸå¾…
    with pytest.raises(ValueError):
        # ã“ã®è¡Œã§ValueErrorãŒç™ºç”Ÿã™ã‚‹ã¯ãš
        divide(10, 0)
    
    # ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚‚ç¢ºèªã—ãŸã„å ´åˆ
    with pytest.raises(ValueError, match="0ã§å‰²ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“"):
        divide(5, 0)


# ========================================
# is_evenã®ãƒ†ã‚¹ãƒˆ
# ========================================

def test_is_even_with_even_numbers():
    """å¶æ•°ã®ãƒ†ã‚¹ãƒˆ"""
    # 2ã¯å¶æ•°ãªã®ã§True
    assert is_even(2) == True
    
    # 100ã¯å¶æ•°ãªã®ã§True
    assert is_even(100) == True
    
    # 0ã¯å¶æ•°ãªã®ã§True
    assert is_even(0) == True


def test_is_even_with_odd_numbers():
    """å¥‡æ•°ã®ãƒ†ã‚¹ãƒˆ"""
    # 3ã¯å¥‡æ•°ãªã®ã§False
    assert is_even(3) == False
    
    # 99ã¯å¥‡æ•°ãªã®ã§False
    assert is_even(99) == False


def test_is_even_with_negative_numbers():
    """è² ã®æ•°ã®ãƒ†ã‚¹ãƒˆ"""
    # -2ã¯å¶æ•°
    assert is_even(-2) == True
    
    # -3ã¯å¥‡æ•°
    assert is_even(-3) == False
```

---

### å®Ÿè¡Œæ–¹æ³•

```bash
# ç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§å…¨ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
pytest

# è©³ç´°è¡¨ç¤ºï¼ˆverboseï¼‰
pytest -v

# ç‰¹å®šã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿å®Ÿè¡Œ
pytest test_calculator.py

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆé–¢æ•°ã®ã¿å®Ÿè¡Œ
pytest test_calculator.py::test_add_positive_numbers

# ãƒ†ã‚¹ãƒˆçµæœã‚’è‰²ä»˜ãã§è¡¨ç¤º
pytest --color=yes
```

**å®Ÿè¡Œçµæœä¾‹ï¼š**
```
================================ test session starts ================================
collected 13 items

test_calculator.py::test_add_positive_numbers PASSED                         [  7%]
test_calculator.py::test_add_negative_numbers PASSED                         [ 15%]
test_calculator.py::test_add_zero PASSED                                     [ 23%]
test_calculator.py::test_subtract_positive_numbers PASSED                    [ 30%]
test_calculator.py::test_subtract_negative_result PASSED                     [ 38%]
test_calculator.py::test_multiply_positive_numbers PASSED                    [ 46%]
test_calculator.py::test_multiply_by_zero PASSED                             [ 53%]
test_calculator.py::test_multiply_negative_numbers PASSED                    [ 61%]
test_calculator.py::test_divide_positive_numbers PASSED                      [ 69%]
test_calculator.py::test_divide_with_remainder PASSED                        [ 76%]
test_calculator.py::test_divide_by_zero PASSED                               [ 84%]
test_calculator.py::test_is_even_with_even_numbers PASSED                    [ 92%]
test_calculator.py::test_is_even_with_odd_numbers PASSED                     [100%]

================================ 13 passed in 0.02s =================================
```

---

## ğŸ“‚ ã‚¹ãƒ†ãƒƒãƒ—3ï¼šåˆ¥ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«åˆ†ã‘ã‚‹

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã‚’ä½œæˆ

```bash
# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ
mkdir my_project
cd my_project
mkdir src tests

# ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
touch src/__init__.py
touch src/calculator.py
touch tests/__init__.py
touch tests/test_calculator.py
```

**æœ€çµ‚çš„ãªæ§‹é€ ï¼š**
```
my_project/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ __init__.py          # ç©ºã§OK
â”‚   â””â”€â”€ calculator.py        # é–¢æ•°æœ¬ä½“
â””â”€â”€ tests/
    â”œâ”€â”€ __init__.py          # ç©ºã§OK
    â””â”€â”€ test_calculator.py   # ãƒ†ã‚¹ãƒˆ
```

---

### ãƒ•ã‚¡ã‚¤ãƒ«1: `src/__init__.py`

```python
# src/__init__.py
"""srcãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®åˆæœŸåŒ–ãƒ•ã‚¡ã‚¤ãƒ«"""

# ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ç©ºã§ã‚‚OK
# ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦èªè­˜ã•ã›ã‚‹ãŸã‚ã«å¿…è¦
```

---

### ãƒ•ã‚¡ã‚¤ãƒ«2: `src/calculator.py`

```python
# src/calculator.py
"""è¨ˆç®—æ©Ÿãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆåˆ¥ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç‰ˆï¼‰"""


def add(a, b):
    """2ã¤ã®æ•°ã‚’è¶³ã™"""
    # aã¨bã‚’è¶³ã—ã¦è¿”ã™
    return a + b


def subtract(a, b):
    """2ã¤ã®æ•°ã‚’å¼•ã"""
    # aã‹ã‚‰bã‚’å¼•ã„ã¦è¿”ã™
    return a - b


def multiply(a, b):
    """2ã¤ã®æ•°ã‚’æ›ã‘ã‚‹"""
    # aã¨bã‚’æ›ã‘ã¦è¿”ã™
    return a * b


def divide(a, b):
    """2ã¤ã®æ•°ã‚’å‰²ã‚‹"""
    # bãŒ0ã‹ãƒã‚§ãƒƒã‚¯
    if b == 0:
        # ã‚¨ãƒ©ãƒ¼ã‚’ç™ºç”Ÿ
        raise ValueError("0ã§å‰²ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“")
    # aã‚’bã§å‰²ã‚‹
    return a / b


def power(base, exponent):
    """ç´¯ä¹—ã‚’è¨ˆç®—"""
    # baseã®exponentä¹—ã‚’è¿”ã™
    return base ** exponent


def factorial(n):
    """éšä¹—ã‚’è¨ˆç®—"""
    # nãŒè² ã®æ•°ãªã‚‰ã‚¨ãƒ©ãƒ¼
    if n < 0:
        raise ValueError("è² ã®æ•°ã®éšä¹—ã¯è¨ˆç®—ã§ãã¾ã›ã‚“")
    
    # 0ã®éšä¹—ã¯1
    if n == 0:
        return 1
    
    # 1ã‹ã‚‰å§‹ã‚ã‚‹
    result = 1
    # 1ã‹ã‚‰nã¾ã§ãƒ«ãƒ¼ãƒ—
    for i in range(1, n + 1):
        # resultã«iã‚’æ›ã‘ã‚‹
        result *= i
    
    # çµæœã‚’è¿”ã™
    return result
```

---

### ãƒ•ã‚¡ã‚¤ãƒ«3: `tests/__init__.py`

```python
# tests/__init__.py
"""testsãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®åˆæœŸåŒ–ãƒ•ã‚¡ã‚¤ãƒ«"""

# ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ç©ºã§ã‚‚OK
```

---

### ãƒ•ã‚¡ã‚¤ãƒ«4: `tests/test_calculator.py`

```python
# tests/test_calculator.py
"""calculator ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒ†ã‚¹ãƒˆï¼ˆåˆ¥ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç‰ˆï¼‰"""

# ã‚·ã‚¹ãƒ†ãƒ ãƒ‘ã‚¹ã‚’æ“ä½œã™ã‚‹ãŸã‚ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
import sys
# OSã®ãƒ‘ã‚¹æ“ä½œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
from pathlib import Path

# ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
import pytest

# ç¾åœ¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹
current_file = Path(__file__)
# ç¾åœ¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®è¦ªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆtests/ï¼‰
tests_dir = current_file.parent
# ã•ã‚‰ã«è¦ªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆmy_project/ï¼‰
project_root = tests_dir.parent

# srcãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒ‘ã‚¹
src_dir = project_root / "src"

# srcãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’Pythonã®ãƒ‘ã‚¹ã«è¿½åŠ 
# ã“ã‚Œã§ src.calculator ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ãã‚‹ã‚ˆã†ã«ãªã‚‹
sys.path.insert(0, str(src_dir))

# ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®é–¢æ•°ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
from calculator import (
    add,           # è¶³ã—ç®—
    subtract,      # å¼•ãç®—
    multiply,      # æ›ã‘ç®—
    divide,        # å‰²ã‚Šç®—
    power,         # ç´¯ä¹—
    factorial      # éšä¹—
)


# ========================================
# addï¼ˆè¶³ã—ç®—ï¼‰ã®ãƒ†ã‚¹ãƒˆ
# ========================================

def test_add_basic():
    """åŸºæœ¬çš„ãªè¶³ã—ç®—"""
    # 2 + 3 = 5
    result = add(2, 3)
    assert result == 5


def test_add_negative():
    """è² ã®æ•°ã®è¶³ã—ç®—"""
    # -5 + 3 = -2
    assert add(-5, 3) == -2


def test_add_float():
    """å°æ•°ã®è¶³ã—ç®—"""
    # 1.5 + 2.5 = 4.0
    result = add(1.5, 2.5)
    assert result == 4.0


# ========================================
# subtractï¼ˆå¼•ãç®—ï¼‰ã®ãƒ†ã‚¹ãƒˆ
# ========================================

def test_subtract_basic():
    """åŸºæœ¬çš„ãªå¼•ãç®—"""
    # 10 - 4 = 6
    assert subtract(10, 4) == 6


def test_subtract_negative_result():
    """çµæœãŒè² ã«ãªã‚‹å¼•ãç®—"""
    # 3 - 10 = -7
    assert subtract(3, 10) == -7


# ========================================
# multiplyï¼ˆæ›ã‘ç®—ï¼‰ã®ãƒ†ã‚¹ãƒˆ
# ========================================

def test_multiply_basic():
    """åŸºæœ¬çš„ãªæ›ã‘ç®—"""
    # 3 * 7 = 21
    assert multiply(3, 7) == 21


def test_multiply_by_zero():
    """0ã‚’æ›ã‘ã‚‹"""
    # ä»»æ„ã®æ•° * 0 = 0
    assert multiply(999, 0) == 0


def test_multiply_negative():
    """è² ã®æ•°ã®æ›ã‘ç®—"""
    # -4 * 5 = -20
    assert multiply(-4, 5) == -20
    # -3 * -3 = 9
    assert multiply(-3, -3) == 9


# ========================================
# divideï¼ˆå‰²ã‚Šç®—ï¼‰ã®ãƒ†ã‚¹ãƒˆ
# ========================================

def test_divide_basic():
    """åŸºæœ¬çš„ãªå‰²ã‚Šç®—"""
    # 20 / 4 = 5.0
    assert divide(20, 4) == 5.0


def test_divide_with_float_result():
    """å°æ•°ã«ãªã‚‹å‰²ã‚Šç®—"""
    # 7 / 2 = 3.5
    result = divide(7, 2)
    assert result == 3.5


def test_divide_by_zero_raises_error():
    """0ã§å‰²ã‚‹ã¨ã‚¨ãƒ©ãƒ¼"""
    # ValueErrorãŒç™ºç”Ÿã™ã‚‹ã“ã¨ã‚’æœŸå¾…
    with pytest.raises(ValueError):
        # ã“ã®è¡Œã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ
        divide(10, 0)


def test_divide_negative():
    """è² ã®æ•°ã®å‰²ã‚Šç®—"""
    # -10 / 2 = -5.0
    assert divide(-10, 2) == -5.0


# ========================================
# powerï¼ˆç´¯ä¹—ï¼‰ã®ãƒ†ã‚¹ãƒˆ
# ========================================

def test_power_basic():
    """åŸºæœ¬çš„ãªç´¯ä¹—"""
    # 2ã®3ä¹— = 8
    assert power(2, 3) == 8


def test_power_zero_exponent():
    """æŒ‡æ•°ãŒ0ã®å ´åˆ"""
    # ä»»æ„ã®æ•°ã®0ä¹— = 1
    assert power(5, 0) == 1
    assert power(100, 0) == 1


def test_power_negative_exponent():
    """è² ã®æŒ‡æ•°"""
    # 2ã®-2ä¹— = 0.25
    result = power(2, -2)
    assert result == 0.25


# ========================================
# factorialï¼ˆéšä¹—ï¼‰ã®ãƒ†ã‚¹ãƒˆ
# ========================================

def test_factorial_zero():
    """0ã®éšä¹—"""
    # 0! = 1
    assert factorial(0) == 1


def test_factorial_basic():
    """åŸºæœ¬çš„ãªéšä¹—"""
    # 5! = 5 * 4 * 3 * 2 * 1 = 120
    assert factorial(5) == 120


def test_factorial_one():
    """1ã®éšä¹—"""
    # 1! = 1
    assert factorial(1) == 1


def test_factorial_large_number():
    """å¤§ããªæ•°ã®éšä¹—"""
    # 10! = 3628800
    assert factorial(10) == 3628800


def test_factorial_negative_raises_error():
    """è² ã®æ•°ã®éšä¹—ã¯ã‚¨ãƒ©ãƒ¼"""
    # ValueErrorãŒç™ºç”Ÿã™ã‚‹ã“ã¨ã‚’æœŸå¾…
    with pytest.raises(ValueError):
        # ã“ã®è¡Œã§ã‚¨ãƒ©ãƒ¼
        factorial(-1)
    
    # ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚‚ç¢ºèª
    with pytest.raises(ValueError, match="è² ã®æ•°ã®éšä¹—ã¯è¨ˆç®—ã§ãã¾ã›ã‚“"):
        factorial(-5)


# ========================================
# ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ãƒ†ã‚¹ãƒˆï¼ˆè¤‡æ•°ã®ã‚±ãƒ¼ã‚¹ã‚’ä¸€åº¦ã«ãƒ†ã‚¹ãƒˆï¼‰
# ========================================

@pytest.mark.parametrize("a, b, expected", [
    # (a, b, æœŸå¾…ã•ã‚Œã‚‹çµæœ)
    (1, 1, 2),      # 1 + 1 = 2
    (0, 0, 0),      # 0 + 0 = 0
    (5, -3, 2),     # 5 + (-3) = 2
    (-10, -5, -15), # -10 + (-5) = -15
    (100, 200, 300),# 100 + 200 = 300
])
def test_add_parametrized(a, b, expected):
    """ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã•ã‚ŒãŸaddã®ãƒ†ã‚¹ãƒˆ"""
    # addã‚’å®Ÿè¡Œ
    result = add(a, b)
    # æœŸå¾…å€¤ã¨æ¯”è¼ƒ
    assert result == expected


@pytest.mark.parametrize("n, expected", [
    # (n, æœŸå¾…ã•ã‚Œã‚‹éšä¹—)
    (0, 1),      # 0! = 1
    (1, 1),      # 1! = 1
    (2, 2),      # 2! = 2
    (3, 6),      # 3! = 6
    (4, 24),     # 4! = 24
    (5, 120),    # 5! = 120
])
def test_factorial_parametrized(n, expected):
    """ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã•ã‚ŒãŸfactorialã®ãƒ†ã‚¹ãƒˆ"""
    # factorialã‚’å®Ÿè¡Œ
    result = factorial(n)
    # æœŸå¾…å€¤ã¨æ¯”è¼ƒ
    assert result == expected
```

---

### ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œï¼ˆåˆ¥ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç‰ˆï¼‰

```bash
# my_project ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§å®Ÿè¡Œ

# å…¨ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
pytest

# testsãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æ˜ç¤ºçš„ã«æŒ‡å®š
pytest tests/

# è©³ç´°è¡¨ç¤º
pytest -v

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
pytest tests/test_calculator.py

# ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚‚è¡¨ç¤ºï¼ˆè¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼špip install pytest-covï¼‰
pytest --cov=src tests/
```

---

## âš™ï¸ ã‚¹ãƒ†ãƒƒãƒ—4ï¼špytestè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

### ãƒ•ã‚¡ã‚¤ãƒ«: `pytest.ini`

```ini
# pytest.ini
# pytestã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

[pytest]
# ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®æ¤œç´¢ãƒ‘ã‚¿ãƒ¼ãƒ³
python_files = test_*.py *_test.py

# ãƒ†ã‚¹ãƒˆé–¢æ•°ã®æ¤œç´¢ãƒ‘ã‚¿ãƒ¼ãƒ³
python_functions = test_*

# ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¹ã®æ¤œç´¢ãƒ‘ã‚¿ãƒ¼ãƒ³
python_classes = Test*

# ãƒ†ã‚¹ãƒˆã‚’æ¢ã™ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
testpaths = tests

# è©³ç´°å‡ºåŠ›ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«
addopts = 
    -v
    --strict-markers
    --color=yes

# ã‚«ã‚¹ã‚¿ãƒ ãƒãƒ¼ã‚«ãƒ¼ã®å®šç¾©
markers =
    slow: å®Ÿè¡Œã«æ™‚é–“ãŒã‹ã‹ã‚‹ãƒ†ã‚¹ãƒˆ
    integration: çµ±åˆãƒ†ã‚¹ãƒˆ
    unit: å˜ä½“ãƒ†ã‚¹ãƒˆ
```

---

## ğŸ¯ ã‚¹ãƒ†ãƒƒãƒ—5ï¼šé«˜åº¦ãªãƒ†ã‚¹ãƒˆãƒ†ã‚¯ãƒ‹ãƒƒã‚¯

### ãƒ•ã‚¡ã‚¤ãƒ«: `tests/test_advanced.py`

```python
# tests/test_advanced.py
"""é«˜åº¦ãªãƒ†ã‚¹ãƒˆãƒ†ã‚¯ãƒ‹ãƒƒã‚¯"""

import sys
from pathlib import Path

# ãƒ‘ã‚¹ã®è¨­å®š
current_file = Path(__file__)
project_root = current_file.parent.parent
src_dir = project_root / "src"
sys.path.insert(0, str(src_dir))

import pytest
from calculator import add, divide, factorial


# ========================================
# ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ï¼ˆãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®æº–å‚™ï¼‰
# ========================================

@pytest.fixture
def sample_numbers():
    """ãƒ†ã‚¹ãƒˆç”¨ã®æ•°å€¤ãƒªã‚¹ãƒˆã‚’æä¾›"""
    # ãƒ†ã‚¹ãƒˆå‰ã«å®Ÿè¡Œã•ã‚Œã‚‹
    print("\n[setUp] ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™")
    # ãƒ†ã‚¹ãƒˆã§ä½¿ã†ãƒ‡ãƒ¼ã‚¿
    data = [1, 2, 3, 4, 5]
    # ãƒ†ã‚¹ãƒˆã«ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™
    yield data
    # ãƒ†ã‚¹ãƒˆå¾Œã«å®Ÿè¡Œã•ã‚Œã‚‹ï¼ˆã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼‰
    print("\n[tearDown] ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—")


def test_with_fixture(sample_numbers):
    """ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ã‚’ä½¿ã†ãƒ†ã‚¹ãƒˆ"""
    # sample_numbers ã«ã¯ [1, 2, 3, 4, 5] ãŒå…¥ã£ã¦ã„ã‚‹
    assert len(sample_numbers) == 5
    # åˆè¨ˆã¯15
    assert sum(sample_numbers) == 15


# ========================================
# ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ãƒ†ã‚¹ãƒˆï¼ˆè¤‡æ•°ã‚±ãƒ¼ã‚¹ã‚’åŠ¹ç‡çš„ã«ï¼‰
# ========================================

@pytest.mark.parametrize("dividend, divisor, expected", [
    # (å‰²ã‚‰ã‚Œã‚‹æ•°, å‰²ã‚‹æ•°, æœŸå¾…çµæœ)
    (10, 2, 5.0),    # 10 / 2 = 5.0
    (9, 3, 3.0),     # 9 / 3 = 3.0
    (7, 2, 3.5),     # 7 / 2 = 3.5
    (1, 1, 1.0),     # 1 / 1 = 1.0
    (-10, 2, -5.0),  # -10 / 2 = -5.0
])
def test_divide_parametrized(dividend, divisor, expected):
    """è¤‡æ•°ã®ã‚±ãƒ¼ã‚¹ã‚’ä¸€åº¦ã«ãƒ†ã‚¹ãƒˆ"""
    # divideã‚’å®Ÿè¡Œ
    result = divide(dividend, divisor)
    # æœŸå¾…å€¤ã¨æ¯”è¼ƒ
    assert result == expected


# ========================================
# ä¾‹å¤–ãƒ†ã‚¹ãƒˆï¼ˆã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã“ã¨ã‚’ç¢ºèªï¼‰
# ========================================

def test_multiple_exceptions():
    """è¤‡æ•°ã®ä¾‹å¤–ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒ†ã‚¹ãƒˆ"""
    # 0ã§å‰²ã‚‹
    with pytest.raises(ValueError) as exc_info:
        divide(10, 0)
    
    # ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª
    assert "0ã§å‰²ã‚‹" in str(exc_info.value)
    
    # è² ã®æ•°ã®éšä¹—
    with pytest.raises(ValueError) as exc_info:
        factorial(-1)
    
    # ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª
    assert "è² ã®æ•°" in str(exc_info.value)


# ========================================
# ãƒãƒ¼ã‚«ãƒ¼ï¼ˆãƒ†ã‚¹ãƒˆã®åˆ†é¡ï¼‰
# ========================================

@pytest.mark.slow
def test_slow_operation():
    """æ™‚é–“ãŒã‹ã‹ã‚‹ãƒ†ã‚¹ãƒˆ"""
    # å¤§ããªæ•°ã®éšä¹—ï¼ˆæ™‚é–“ãŒã‹ã‹ã‚‹ï¼‰
    result = factorial(20)
    # 20! = 2432902008176640000
    assert result == 2432902008176640000


@pytest.mark.unit
def test_unit_add():
    """å˜ä½“ãƒ†ã‚¹ãƒˆ"""
    # ã‚·ãƒ³ãƒ—ãƒ«ãªå˜ä½“ãƒ†ã‚¹ãƒˆ
    assert add(1, 1) == 2


# ãƒãƒ¼ã‚«ãƒ¼ä»˜ããƒ†ã‚¹ãƒˆã®å®Ÿè¡Œæ–¹æ³•:
# pytest -m slow        # slowãƒãƒ¼ã‚«ãƒ¼ã®ã¿å®Ÿè¡Œ
# pytest -m "not slow"  # slowä»¥å¤–ã‚’å®Ÿè¡Œ
# pytest -m unit        # unitãƒãƒ¼ã‚«ãƒ¼ã®ã¿å®Ÿè¡Œ


# ========================================
# è¿‘ä¼¼æ¯”è¼ƒï¼ˆæµ®å‹•å°æ•°ç‚¹ï¼‰
# ========================================

def test_float_comparison():
    """æµ®å‹•å°æ•°ç‚¹ã®è¿‘ä¼¼æ¯”è¼ƒ"""
    # 0.1 + 0.2 ã¯å³å¯†ã«ã¯ 0.3 ã«ãªã‚‰ãªã„
    result = 0.1 + 0.2
    
    # âŒ ã“ã‚Œã¯å¤±æ•—ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
    # assert result == 0.3
    
    # âœ… è¿‘ä¼¼æ¯”è¼ƒã‚’ä½¿ã†
    assert result == pytest.approx(0.3)
    
    # è¨±å®¹èª¤å·®ã‚’æŒ‡å®š
    assert result == pytest.approx(0.3, abs=1e-9)


# ========================================
# è¤‡æ•°ã®assertï¼ˆã™ã¹ã¦å®Ÿè¡Œï¼‰
# ========================================

def test_multiple_assertions():
    """è¤‡æ•°ã®æ¤œè¨¼ã‚’å«ã‚€ãƒ†ã‚¹ãƒˆ"""
    # è¤‡æ•°ã®assertã‚’æ›¸ã
    assert add(1, 2) == 3
    assert add(5, 5) == 10
    assert add(0, 0) == 0
    # ã©ã‚Œã‹1ã¤ã§ã‚‚å¤±æ•—ã—ãŸã‚‰ãƒ†ã‚¹ãƒˆå¤±æ•—


# ========================================
# ã‚¹ã‚­ãƒƒãƒ—ã¨xfailï¼ˆæ¡ä»¶ä»˜ãå®Ÿè¡Œï¼‰
# ========================================

@pytest.mark.skip(reason="ã¾ã å®Ÿè£…ä¸­")
def test_not_implemented_yet():
    """æœªå®Ÿè£…ã®æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ"""
    # ã“ã®ãƒ†ã‚¹ãƒˆã¯ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã‚‹
    assert False


@pytest.mark.skipif(sys.platform == "win32", 
                   reason="Windowsã§ã¯å‹•ä½œã—ãªã„")
def test_unix_specific():
    """Unixå°‚ç”¨ã®ãƒ†ã‚¹ãƒˆ"""
    # Windowsã§ã¯ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã‚‹
    assert True


@pytest.mark.xfail(reason="æ—¢çŸ¥ã®ãƒã‚°")
def test_known_bug():
    """å¤±æ•—ã™ã‚‹ã“ã¨ãŒã‚ã‹ã£ã¦ã„ã‚‹ãƒ†ã‚¹ãƒˆ"""
    # å¤±æ•—ã—ã¦ã‚‚å…¨ä½“ã®ãƒ†ã‚¹ãƒˆçµæœã«å½±éŸ¿ã—ãªã„
    assert 1 + 1 == 3  # ã‚ã–ã¨é–“é•ã„
```

---

## ğŸ“Š ã‚¹ãƒ†ãƒƒãƒ—6ï¼šãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã®ç¢ºèª

```bash
# pytest-covã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install pytest-cov

# ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’æ¸¬å®š
pytest --cov=src tests/

# HTMLãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ
pytest --cov=src --cov-report=html tests/

# ãƒ¬ãƒãƒ¼ãƒˆã‚’é–‹ã
# htmlcov/index.html ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã
```

---

## ğŸ“ ã‚¹ãƒ†ãƒƒãƒ—7ï¼šrequirements.txt

```text
# requirements.txt
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

pytest==7.4.3
pytest-cov==4.1.0
```

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼š
```bash
pip install -r requirements.txt
```

---

## ğŸ¯ å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰ã¾ã¨ã‚

```bash
# åŸºæœ¬çš„ãªå®Ÿè¡Œ
pytest                          # ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
pytest -v                       # è©³ç´°è¡¨ç¤º
pytest -s                       # printæ–‡ã‚’è¡¨ç¤º
pytest tests/                   # testsãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ã¿

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
pytest tests/test_calculator.py                    # ç‰¹å®šãƒ•ã‚¡ã‚¤ãƒ«
pytest tests/test_calculator.py::test_add_basic    # ç‰¹å®šé–¢æ•°

# ãƒãƒ¼ã‚«ãƒ¼ã§çµã‚Šè¾¼ã¿
pytest -m slow                  # slowãƒãƒ¼ã‚«ãƒ¼ã®ã¿
pytest -m "not slow"            # slowä»¥å¤–

# ã‚«ãƒãƒ¬ãƒƒã‚¸
pytest --cov=src tests/         # ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š
pytest --cov=src --cov-report=html tests/  # HTMLãƒ¬ãƒãƒ¼ãƒˆ

# å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã®ã¿å†å®Ÿè¡Œ
pytest --lf                     # last-failed

# ä¸¦åˆ—å®Ÿè¡Œï¼ˆè¦pytest-xdistï¼‰
pytest -n auto                  # è‡ªå‹•ã§ä¸¦åˆ—æ•°æ±ºå®š
```

---

## âœ… ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] pytestã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸ
- [ ] ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«åã¯ `test_*.py` ã§å§‹ã¾ã‚‹
- [ ] ãƒ†ã‚¹ãƒˆé–¢æ•°åã¯ `test_*` ã§å§‹ã¾ã‚‹
- [ ] `assert` ã§æ¤œè¨¼ã—ã¦ã„ã‚‹
- [ ] ä¾‹å¤–ãƒ†ã‚¹ãƒˆã¯ `pytest.raises()` ã‚’ä½¿ã†
- [ ] ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã§è¤‡æ•°ã‚±ãƒ¼ã‚¹ã‚’ãƒ†ã‚¹ãƒˆ
- [ ] ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’ç¢ºèªã—ãŸ

---

ã“ã‚Œã§å®Œç’§ï¼å®Ÿéš›ã«ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦è©¦ã—ã¦ã¿ã¦ãã ã•ã„ï¼ğŸš€
